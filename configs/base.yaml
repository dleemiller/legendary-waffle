model:
  d_model: 768
  n_layers: 12
  n_heads: 12
  d_ff: 3072
  dropout: 0.1
  vocab_size: 100  # will be set from tokenizer
  max_path_len: 128
  max_char_len: 48
  path_input_dim: 6  # (x, y, dx, dy, ds, log_dt)
  predict_path: true
  predict_length: true
  predict_char: true

data:
  dataset_name: "futo-org/swipe.futo.org"
  train_split: "train"
  val_split: "validation"
  test_split: "test"
  max_path_len: 128
  max_char_len: 48
  char_mask_prob: 0.5      # Used by Masked/Validation collators only
  path_mask_prob: 0.5      # Used by Masked/Validation collators only
  mask_path: true
  num_workers: 4

training:
  # Custom SwipeALot parameters
  char_loss_weight: 1.0
  path_loss_weight: 0.5
  length_loss_weight: 0.2
  contrastive_weight: 0.2
  use_focal_loss: true
  focal_gamma: 2.0
  use_char_freq_weights: true
  char_weights_path: "checkpoints/char_weights.pt"
  use_pairwise_masking: true
  pairwise_modality_prob: 0.2  # 20% modality masking, 80% inverted masking
  pairwise_zero_attention_prob: 0.5
  # Inverted-mode masking probabilities (can be scalar or [min, max] ranges)
  pairwise_inverted_char_prob_heavy: [0.5, 0.7]
  pairwise_inverted_path_prob_heavy: [0.5, 0.7]
  pairwise_inverted_char_prob_light: [0.1, 0.2]
  pairwise_inverted_path_prob_light: [0.1, 0.2]
  contrastive_temperature: 0.07
  matryoshka_dims: [64, 128, 384, 768]
  matryoshka_weights: [2.0, 1.5, 1.0, 1.0]

  # Standard HuggingFace TrainingArguments (single source for batch size)
  training_args:
    output_dir: "checkpoints"
    num_train_epochs: 50
    per_device_train_batch_size: 512
    per_device_eval_batch_size: 512
    gradient_accumulation_steps: 1
    learning_rate: 0.0001
    weight_decay: 0.01
    warmup_steps: 3600
    lr_scheduler_type: "cosine"
    logging_dir: "logs"
    logging_steps: 10
    logging_strategy: "steps"
    eval_strategy: "steps"
    eval_steps: 1000
    save_steps: 1000
    save_total_limit: 2
    load_best_model_at_end: true
    metric_for_best_model: "char_accuracy"
    greater_is_better: true
    bf16: true
    fp16: false
    remove_unused_columns: false
    report_to: ["tensorboard"]
    dataloader_num_workers: 4
    dataloader_pin_memory: true
    max_grad_norm: 1.0
    save_strategy: "steps"
    save_safetensors: true
    prediction_loss_only: false
